// This is a hashbang include. You can run the command after the #! to see what
// configuration is being extracted from the Gradle build using the Conveyor plugin.
include "#!./gradlew -q printConveyorConfig"

// This enables native library extraction, which improves app startup time and robustness.
// It's optional but a good idea to have it. You can remove this if you get tired of specifying
// system properties for Java libraries with native components.
//
// See https://hydraulic.dev/blog/11-in-jar-signing.html for more.
include required("https://raw.githubusercontent.com/hydraulic-software/conveyor/master/configs/jvm/extract-native-libraries.conf")

include required("/stdlib/jdk/17.0.8.1/jetbrains.conf")

gradle-cache = ${env.HOME}/.gradle

// Config file documentation: https://conveyor.hydraulic.dev/latest/configs
app {
  fsname = "compose-flow"

  // This is optional. If not specified the last component of the rdns name will be turned into a display name.
  display-name = "ComposeFlow"

  // A global identifier for the app.
  rdns-name = "io.composeflow.desktop"

  // Use the Compose logo as an icon and include it so we can pass it to the Window constructor.
  icons = icons/icon.svg
  windows.inputs += TASK/rendered-icons/windows
  linux.inputs += TASK/rendered-icons/linux

  // For iteration speed. Remove for release.
  compression-level = low

  // Check for and apply updates synchronously on every app launch instead of in the background.
  updates = manual

  jvm {
    modules += jdk.compiler
  }

  windows {
    store {
      identity-name = "ComposeFlowInc.ComposeFlow"
      publisher = ${env.WINDOWS_STORE_PUBLISHER}
      publisher-display-name = ${env.WINDOWS_STORE_PUBLISHER_DISPLAY_NAME}
      store-id = "9MXDX6MF2CRQ"
    }
    certificate = "self signed by "${app.windows.store.publisher}
  }

  site {
    base-url = ${env.SITE_BASE_URL}
    // copy-to = "s3:my-bucket/path/to/site"   // Optional, inferred automatically.
    s3 {
      region = "ap-northeast-1"
      access-key-id = ${env.AWS_ACCESS_KEY_ID}
      secret-access-key = ${env.AWS_SECRET_ACCESS_KEY}
    }
    consistency-checks = warn
  }
}

app.mac {
  info-plist.LSMinimumSystemVersion = 15.0.0
}

app.windows.store.client-id = ${env.WINDOWS_STORE_CLIENT_ID}
app.windows.store.client-secret = ${env.WINDOWS_STORE_CLIENT_SECRET}
app.windows.store.tenant-id = ${env.WINDOWS_STORE_TENANT_ID}

conveyor.compatibility-level = 15
conveyor.billing-email=${env.CONVEYOR_BILLING_EMAIL}

conveyor.license-key = ${env.CONVEYOR_LICENSE_KEY}
